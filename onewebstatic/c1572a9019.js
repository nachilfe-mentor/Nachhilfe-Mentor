var blogUtilsInPublish={getHtml:async function(url,data){const abortCtrl=new AbortController;const signal=abortCtrl.signal;const timeoutId=setTimeout(()=>abortCtrl.abort('Timeout after 90 seconds'),90000);try{const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data),signal});if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}const result=await response.json();return result}catch(error){throw error}finally{clearTimeout(timeoutId)}},LINK_TYPES:{BLOG:'home',POST:'post',CATEGORY:'category',BLOG_PAGE:'blog-page',CATEGORY_PAGE:'category-page'},PAGE_TYPES:{BLOG:'BLOG',POST:'POST',CATEGORY:'CATEGORY'},getLinksData:function({elt}){let linksData=[];const links=elt.querySelectorAll('[data-link-type]');for(const link of links){const urlObj=new URL(link.href);parts=urlObj.pathname.split('/');const params=new URLSearchParams(urlObj.search);const page=params.get('page')||1;linkType=link.getAttribute('data-link-type');if(linkType===this.LINK_TYPES.BLOG_PAGE){linksData.push({link,page,nextPageType:this.PAGE_TYPES.BLOG})}if(linkType===this.LINK_TYPES.CATEGORY_PAGE){linksData.push({link,category:parts[parts.length-2],nextPageType:this.PAGE_TYPES.CATEGORY,page})}}return linksData},scrollAction:'scrollToBlogInPublish',getFixedHeaderHeight:function(){const fixedHeader=document.querySelector('.mobileV [data-mobile-pin="1"]')||[...document.querySelectorAll('[data-specific-kind="SECTION"][data-pin="1"]')].find(el=>el.getBoundingClientRect().top===0);return fixedHeader?fixedHeader.offsetHeight+10:0},scrollToElement(element){const fixedHeaderHeight=this.getFixedHeaderHeight();if(!fixedHeaderHeight){element.scrollIntoView({behavior:'smooth'})}else{const elementPosition=element.getBoundingClientRect().top+window.scrollY;const offsetPosition=elementPosition-fixedHeaderHeight;window.scrollTo({top:offsetPosition,behavior:'smooth'})}},updateBlog:async function(inpData){let {blogHostName,partnerName,siteId,isHomePage,blogPageUrlPrefix,blogPageUrl,blogId,layout,locale,selectedParentTheme,webspaceAssetPrefix,blogEltId,category,page}=inpData;let dataToPost={forPublish:true,assetPrefix:blogHostName,isHomePage,blogPageUrlPrefix,blogPageUrl,blogId,layout,locale,selectedParentTheme,webspaceAssetPrefix,category,page};let blogElt=document.getElementById(blogEltId);if(localStorage.getItem(this.scrollAction)){this.scrollToElement(blogElt);localStorage.removeItem(this.scrollAction)}const replaceAndReloadScripts=scriptUrls=>{scriptUrls.forEach(url=>{const existingScript=document.querySelector(`script[src="${url}"]`);if(existingScript){existingScript.remove()}const script=document.createElement('script');script.src=url;script.async=true;document.body.appendChild(script)})};const fetchAndUpdateHtml=async({page,browserBack})=>{try{dataToPost.page=page;if(!browserBack){let url=new URL(window.location.href);url.searchParams.set('page',page);window.history.pushState({blog_page:page},'',url)}blogElt.setAttribute('data-loading','true');const result=await this.getHtml(`${blogHostName}/preview/${partnerName}/${siteId}`,dataToPost);blogElt.innerHTML=result.content;if(result.scripts&&Array.isArray(result.scripts)){replaceAndReloadScripts(result.scripts)}this.scrollToElement(blogElt);processLinks()}catch(err){console.error('Failed to load blog page',err);blogElt.setAttribute('data-error','true')}finally{blogElt.removeAttribute('data-loading')}};const processLinks=()=>{let linksData=this.getLinksData({elt:blogElt});for(let item of linksData){item.link.addEventListener('click',async event=>{event.preventDefault();fetchAndUpdateHtml({page:item.page})})}};window.addEventListener('popstate',function(event){if(event.state&&event.state.blog_page){fetchAndUpdateHtml({page:event.state.blog_page,browserBack:true})}else{location.reload()}});processLinks()},updatePostLinks:function(){document.querySelector(`[data-link-type=${this.LINK_TYPES.BLOG}]`).addEventListener('click',event=>{localStorage.setItem(this.scrollAction,true)})}};